import{r as a,A as De,u as we,a as Se,b as Fe,d as Le,c as Te,j as e,S as Ee,e as Oe,g as Ae,M as A,C as P,D as w,t as Pe,f as Re,v as Me,i as Ue,h,k as Ie,l as R,m as qe,n as ze,o as Ve}from"./index-BILuRQv3.js";import{M as re}from"./multiselect.esm-CYK3Z473.js";const Ze=$e=>{let{metadataMaster:M,setMetadataMaster:oe,expandedKeys:Be,setExpandedKeys:ie,SaveInProgList:ce,setSaveInProgList:U,changedStructList:We,setChangedStructList:Je,structSaveErrorList:Ke,setStructSaveErrorList:I,proj:S,UserName:_,sessionKey:ne,showLog:pe,baseURL:b,activeFormDetails:Ge,setActiveFormDetails:me,toast:d,formdata:t,setFormData:f,handleFieldChange:o,currChangedFields:de,updateDependentFields:ue,isFormDirty:he,setIsFormDirty:F,DDLloader:g,activeDDLField:j,handleDropdown:y,toggleProgress:He,fetchStructDataFromDB:q,beforeFormSubmit:fe,setShowAppLoader:ge,setDndPopupOpen:ke,setDndPopupMode:Ne,setDndTreeData:xe}=a.useContext(De);const z=we(),l=Se().state;Fe();const[k,N]=a.useState(!0),[V,$]=a.useState(!1),[v,B]=a.useState(!0),[C,W]=a.useState(!0),[D,J]=a.useState(!0),[L,K]=a.useState([]);a.useState(!1);const[T,G]=a.useState([]),[E,H]=a.useState([]),[Q,X]=a.useState([]),[Y,Z]=a.useState([]),_e={name:"",caption:"",schema:"",menuaccess:!0,pform:"yes",saveCtrlFld:"",saveCtrlFldCaption:"",saveCtrlFldsDDN:"",dltCtrlFld:"",dltCtrlFldCaption:"",dltCtrlFldsDDN:"",tracking:!1,trackby:"",trackusrs:"",trackUsrsDDN:[],trackfldOption:"",trackFlds:"",trackFldCaps:"",trackFldsDDN:[],allowconfig:!1,enablecache:!1,enablewf:!1,allowattch:!1,enableListVW:!0,purpose:""};let x=a.useRef(),ee=a.useRef(),te=a.useRef(),se=a.useRef(),ae=a.useRef(),le=a.useRef(!0);a.useEffect(()=>{$(!1),F(!1),N(!0),B(!0),W(!0),J(!0),me(l),l.mode=="edit"?(async()=>{if(l.structstatus=="ready"){const s=new URL(`${b}/GetData/form`);s.searchParams.append("projname",S),s.searchParams.append("username",_),s.searchParams.append("structType","tstruct"),s.searchParams.append("structName",l.structname),s.searchParams.append("compName","props");try{const i=await fetch(s,{method:"POST"});if(i.ok){const n=await i.json();if(n.status!="failure")n.status=="locked"&&(d.current.show({severity:"warn",summary:"warning",detail:n.message}),$(!0)),f(JSON.parse(n.result)),setTimeout(()=>{var r;N(!1),(r=x.current)==null||r.scrollIntoView({behavior:"smooth"})},200);else{const r=await q(l.structname,"tstruct");r&&(f(r),N(!1))}}else d.current.show({severity:"error",summary:"Error!",detail:i.statusText})}catch(i){d.current.show({severity:"error",summary:"Error!",detail:i})}}else{const s=await q(l.structname,"tstruct");s&&(f(s),N(!1))}})():(f(_e),setTimeout(()=>{var s;N(!1),(s=x.current)==null||s.scrollIntoView({behavior:"smooth"})},200)),G([]),H([]),X([]),Z([])},[l]),a.useEffect(()=>{const s=ue(t,de,Le);Object.keys(s).length>0&&f(i=>({...i,...s}))},[t]),a.useEffect(()=>{if(!k)if(V)Te("right-panel");else{const s=x.current.querySelector("input:not([readonly]):not([disabled]), textarea:not([readonly]):not([disabled]), select:not([readonly]):not([disabled])");s&&s.focus()}},[k]),a.useLayoutEffect(()=>{if(!k)if(le.current){const s=document.getElementsByClassName("section_label"),i=[];for(let n of s)i.push(n.innerText);K(i),le.current=!1}else{const s=document.getElementsByClassName("section_label"),i=[];for(let n of s)i.push(n.innerText);K(i)}},[t,k]);const be=s=>{if(s==="Main")return ee;if(s==="Options")return te;if(s==="Tracking")return se},je=s=>{s.target.value=Me(s.target.value),o(s)},ye=async()=>{F(!1);let s="";(async()=>{if(t.name=="")return s="Transid can not be empty",!1;if(Ue(t.name))return s="Name cannot be a reserved keyword",!1;if(t.caption=="")return s="Caption can not be empty",!1;if(l.mode=="new"){if(M.some(r=>r.structtype==="tstruct"&&r.structname.toLowerCase()===t.name.toLowerCase()))return s="Duplicate Transid is not allowed.",!1;{const r=new URL(`${b}/General/checkduplicatestructname`);if(r.searchParams.append("ProjName",S),r.searchParams.append("UserName",_),r.searchParams.append("StructName",t.name.toLowerCase()),r.searchParams.append("StructType","tstruct"),!(await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)return s="Duplicate Transid is not allowed.",!1}}return!0})().then(async n=>{if(!n)F(!0),d.current.show({severity:"error",summary:"Error!",detail:s});else{const u=h("tstruct",t.name);var r=`${b}♠${_}♠${u}`;if(fe(u,r,l),l.mode==="edit"){let c=[...M],p;c=c.filter(m=>{if(m.key===h("tstruct",t.name,""))p={...m,structcaption:t.caption,title:e.jsx(Ie,{node:{...m,structcaption:t.caption}})};else return m}),c.splice(0,0,p),oe(c)}let Ce={mode:l.mode,projName:S,userName:_,sessionID:ne,trace:pe,structName:t.name,structCaption:t.caption,structType:"tstruct",isComp:!1,compJSON:JSON.stringify({}),propvalJSON:JSON.stringify(t)};await fetch(`${b}/SaveFormData`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ce)}).then(c=>c.ok?c.json():c.json().then(p=>{throw new Error(p)})).then(async c=>{if(c.success){U(m=>m.filter(O=>O!==u)),localStorage.removeItem(r);var p=`${t.caption} (${t.name}) created successfully.`;if(l.mode=="edit"&&(p=`${t.caption} (${t.name}) saved successfully.`),d.current.show({severity:"success",summary:"success",detail:p}),l.mode=="new"){ge(!0);const m={structtype:"tstruct",structname:t.name,structcaption:t.caption,structstatus:"ready",key:h("tstruct",t.name,""),title:e.jsx(R,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,structstatus:"ready"}}),data:t.name,isLeaf:!1,icon:e.jsx(qe,{}),childrenfetched:!0,className:"dropAtNode",children:[{key:h("tstruct",t.name,"dc1"),title:e.jsx(R,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"dc",compname:"dc1",compcaption:t.caption,ordno:1}}),isLeaf:!1,ordno:1,structtype:"tstruct",structname:t.name,structcaption:t.caption,childrenfetched:!0,comp:"dc",compname:"dc1",compcaption:t.caption,asgrid:!1,tablename:t.name+"1",icon:e.jsx(ze,{}),className:"dropAtNode",children:[]},{key:h("tstruct",t.name,"defbtns"),title:e.jsx(R,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"defbtns",compname:"defbtns",compcaption:"Default Buttons",ordno:1}}),isLeaf:!0,ordno:1,structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"defbtns",compname:"defbtns",compcaption:"Default Buttons",icon:e.jsx(Ve,{})}]};ie(O=>[...O,h("tstruct",t.name,"")]),z("/"),xe([m]),Ne("new"),ke(!0)}}else throw new Error(c.message)}).catch(c=>{U(p=>p.filter(m=>m!==u)),I[u]==null&&I(p=>[...p,u]),c.message=="Session authentication failed."?(d.current.show({severity:"error",summary:"Error!",detail:"Session expired!"}),z("/logout")):d.current.show({severity:"error",summary:"Error!",detail:"Error while saving data!"})})}})},ve=()=>{const s=h("tstruct",l.structname);return!V&&he?!(l.mode=="edit"&&ce.includes(s)):!1};return k?e.jsx(Ee,{}):e.jsx(e.Fragment,{children:Object.keys(t).length===0?e.jsx("div",{}):e.jsxs("div",{className:"proplist_wrapper",ref:x,children:[e.jsx(Oe,{title:Ae(t.name,t.caption),path:"Tstructs",type:"tstprops"}),e.jsxs("div",{id:"quickLinks",className:"",children:[e.jsx("button",{onClick:()=>{x.current.scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".quicklinks_button").forEach(s=>s.classList.remove("quicklinks_active_button"))},className:"p-2",children:"Top"}),L==null?void 0:L.map(s=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"separator",children:"."}),e.jsx("button",{onClick:i=>{document.querySelectorAll(".quicklinks_button").forEach(r=>r.classList.remove("quicklinks_active_button")),i.currentTarget.classList.add("quicklinks_active_button"),be(s).current.scrollIntoView({behavior:"smooth"})},className:"quicklinks_button p-2",children:s})]})),e.jsx("span",{className:"separator",children:"."}),e.jsx("button",{onClick:()=>{ae.current.scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".quicklinks_button").forEach(s=>s.classList.remove("quicklinks_active_button"))},className:"p-2",children:"Bottom"})]}),e.jsx("div",{className:"proplist_body",children:e.jsxs("form",{children:[e.jsx("div",{className:"proplist_label",id:"proplist_label_main",ref:ee,children:e.jsxs("a",{role:"button",onClick:()=>B(!v),"aria-expanded":v,"aria-controls":"proplist_collapse_main",className:"d-flex align-items-center",children:[e.jsx(A,{className:"me-2 collapse_icon",style:{transform:v?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Main"})]})}),e.jsx("div",{id:"proplist_main",className:"proplist_division",children:e.jsx(P,{in:v,children:e.jsxs("div",{id:"proplist_collapse_main",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsxs("li",{className:"list-group-item  proplist_item  proplist_key",children:["Transid & Caption ",e.jsx("span",{className:"allowempty",children:"*"})]}),e.jsxs("li",{className:"list-group-item  proplist_item proplist_value flex-nowrap",children:[e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpName",name:"name",value:t.name=="_ _"?"":t.name,onChange:je,maxLength:"5",type:"text","aria-label":"transid",placeholder:"Enter Transid",readOnly:l.mode!="new",disabled:l.mode=="edit"}),e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpCaption",name:"caption",value:t.caption=="_ _"?"":t.caption,onChange:o,maxLength:"50",type:"text","aria-label":"caption",placeholder:"Enter Caption"})]})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key",children:"Form Accessible From Menu?"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("div",{className:"form-check form-switch ",children:e.jsx("input",{className:"form-check-input  proplist_formcontrol",type:"checkbox",id:"chkMenuAccess",name:"menuaccess",onChange:o,checked:t.menuaccess})})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key",children:"Schema"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpSchema",name:"schema",onChange:o,value:t.schema,type:"text","aria-label":"schema"})})]})]})})}),e.jsx("div",{className:"proplist_label",id:"proplist_label_options",ref:te,children:e.jsxs("a",{role:"button",onClick:()=>W(!C),"aria-expanded":C,"aria-controls":"proplist_collapse_options",className:"d-flex align-items-center",children:[e.jsx(A,{className:"me-2 collapse_icon",style:{transform:C?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Options"})]})}),e.jsx("div",{className:"proplist_division ",id:"proplist_options",children:e.jsx(P,{in:C,children:e.jsxs("div",{id:"proplist_collapse_options",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key "}),e.jsxs("li",{className:"list-group-item  proplist_item proplist_value",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"allowconfig",onChange:o,id:"chkAllowConfig",checked:t.allowconfig===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkAllowConfig",children:"Allow configuration"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",value:"",name:"enablecache",onChange:o,id:"chkEnblCache",checked:t.enablecache===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnblCache",children:"Enable cached saving"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"allowattch",onChange:o,value:"",id:"chkAlwAtt",checked:t.allowattch===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkAlwAtt",children:"Allow Attachment"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"enableListVW",onChange:o,value:"",id:"chkEnaList",checked:t.enableListVW===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnbllst",children:"Enable List View"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"enablewf",onChange:o,value:"",id:"chkEnaWf",checked:t.enablewf===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnblWf",children:"Enable Workflow"})]})]})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Save control field"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"saveCtrlFldsDDN",value:t.saveCtrlFldsDDN,onChange:o,onShow:()=>y("saveCtrlFldsDDN","FLDLIST",T,G,l),options:T.length?T:t.saveCtrlFldsDDN?[t.saveCtrlFldsDDN]:[],...j==="saveCtrlFldsDDN"&&g?{loading:!0}:{},optionLabel:"caption",placeholder:"-- select --",showClear:!0,filter:!0,display:"chip",id:"selSaveCtrl",className:"proplist_formcontrol"})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Delete control field"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"dltCtrlFldsDDN",value:t.dltCtrlFldsDDN,onChange:o,onShow:()=>y("dltCtrlFldsDDN","FLDLIST",E,H,l),options:E.length?E:t.dltCtrlFldsDDN?[t.dltCtrlFldsDDN]:[],...j==="dltCtrlFldsDDN"&&g?{loading:!0}:{},optionLabel:"caption",placeholder:"-- select --",showClear:!0,filter:!0,display:"chip",id:"selDltCtrl",className:"proplist_formcontrol"})})]})]})})}),e.jsx("div",{className:"proplist_label",id:"proplist_label_Tracking",ref:se,children:e.jsxs("a",{role:"button",onClick:()=>J(!D),"aria-expanded":D,"aria-controls":"proplist_collapse_tracking",className:"d-flex align-items-center",children:[e.jsx(A,{className:"me-2 collapse_icon",style:{transform:D?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Tracking"})]})}),e.jsx("div",{className:"proplist_division ",id:"proplist_Tracking",children:e.jsx(P,{in:D,children:e.jsxs("div",{id:"proplist_collapse_tracking",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("div",{className:"form-check form-switch ",children:e.jsx("input",{className:"form-check-input  proplist_formcontrol",type:"checkbox",id:"chkTrack",name:"tracking",onChange:o,checked:t.tracking})})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track changes made by"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"trackby",value:t.trackby,onChange:o,options:Pe,optionLabel:"caption",optionValue:"name",placeholder:"-- select --",showClear:!0,id:"selTrckChngUsr",className:"proplist_formcontrol",ariaLabel:"Track changes made by",...t.tracking?{}:{disabled:!0}})})]}),t.tracking&&t.trackby==="Selected Users"&&e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track change users"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(re,{name:"trackUsrsDDN",value:t.trackUsrsDDN,onChange:o,onShow:()=>y("trackUsrsDDN","USERLIST",Q,X,l),...j==="trackUsrsDDN"&&g?{loading:!0}:{},emptyMessage:g?"Loading...":"No options found",options:Q,optionLabel:"caption",placeholder:"--- Select Users ---",filter:!0,display:"chip",id:"selTrkUsrs",className:"proplist_formcontrol"})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track changes to fields"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"trackfldOption",value:t.trackfldOption,onChange:o,options:Re,optionLabel:"caption",optionValue:"name",placeholder:"-- select --",showClear:!0,id:"selTrkChngFld",className:"proplist_formcontrol",ariaLabel:"Track changes to fields",...t.tracking?{}:{disabled:!0}})})]}),t.tracking&&t.trackfldOption==="Selected fields"&&e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track change fields"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(re,{name:"trackFldsDDN",value:t.trackFldsDDN,onChange:o,onShow:()=>y("trackFldsDDN","FLDLIST",Y,Z,l),...j==="trackFldsDDN"&&g?{loading:!0}:{},options:Y,optionLabel:"caption",placeholder:"--- Select Fields ---",filter:!0,display:"chip",id:"selTrkFlds",className:"proplist_formcontrol"})})]})]})})}),e.jsx("div",{className:"proplist_division mt-4",ref:ae,children:e.jsx("div",{id:"proplist_collapse_purpose",className:"proplist_collapse",children:e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item proplist_key",children:"Purpose"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value ",children:e.jsx("div",{className:" w-100",children:e.jsx("textarea",{className:"form-control proplist_formcontrol w-100",id:"txtPurpose",name:"purpose",onChange:o,rows:"3"})})})]})})}),e.jsx("button",{type:"button",onClick:ye,className:"btn btn-primary btnSubmit",...ve()?{}:{disabled:!0},children:"Submit"})]})})]})})};export{Ze as default};
