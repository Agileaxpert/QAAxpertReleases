/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}var dtCulture=eval(callParent("glCulture")),advFilterDtCulture="en-us"==dtCulture?"MM/DD/YYYY":"DD/MM/YYYY",dateOptions=["Custom","Today","Yesterday","Tomorrow","This week","Last week","Next week","This month","Last month","Next month","This quarter","Last quarter","Next quarter","This year","Last year","Next year"],dateOptionsId=["customOption","todayOption","yesterdayOption","tomorrowOption","this_weekOption","last_weekOption","next_weekOption","this_monthOption","last_monthOption","next_monthOption","this_quarterOption","last_quarterOption","next_quarterOption","this_yearOption","last_yearOption","next_yearOption"],EntityFilter=function(){function EntityFilter(){_classCallCheck(this,EntityFilter),this.metaData={},this.filterObj=[],this.pageName="",this.filterObj={},this.activeFilterArray=[],this.activeFilterName="",this.activeFilterId="",this.entityTransId=""}return _createClass(EntityFilter,[{key:"isUndefined",value:function(t){return void 0===t}},{key:"init",value:function(){var t=this;t.activeFilterArray=[],t.activeFilterName="",t.activeFilterId="",t.createFilterLayout(),$("#applyFilterButton").on("click",function(){t.handleApply()}),$("#filterModal").modal("show")}},{key:"checkUrlFilters",value:function(){var t=window.location.search,e=new URLSearchParams(t);if("true"==e.get("applyfilter")&&e.get("filterfld")){var a=e.get("filterfld"),i=this.metaData.find(function(t){return t.fldname==a});if(i){var l=this.getFieldDataType(i);"NUMERIC"!=(l=l.toUpperCase())&&"DATE"!=l&&"TEXT"!=l&&"DROPDOWN"!=l&&(l="TEXT"),this.activeFilterArray=[];var r={};switch(l){case"DROPDOWN":var n=e.get("filterval");_entityCommon.isValid(n)&&(r={ftransid:_entityFilter.entityTransId,fldname:a,datatype:l,value:[n]});break;case"DATE":var o=e.get("filterfrom"),c=e.get("filterto");c=moment(c,"DD-MMM-YYYY").subtract(1,"days").format("DD-MMM-YYYY"),r={ftransid:_entityFilter.entityTransId,fldname:a,datatype:l,from:"",to:""},_entityCommon.isValid(o)&&(r.from=o),_entityCommon.isValid(c)&&(r.to=c),r.condition="customOption";break;case"TEXT":n=e.get("filterval");_entityCommon.isValid(n)&&(r={ftransid:_entityFilter.entityTransId,fldname:a,datatype:l,value:n}),r.condition="EQUALS";break;default:return}this.activeFilterArray.push(r);var s=this.constructFilterCaption(this.activeFilterArray);this.activeFilterId=this.getCurrentTimestamp(),this.activeFilterName=s,this.filterObj[this.activeFilterId]={caption:this.activeFilterName,filter:this.activeFilterArray,save:!1},this.createFilterPills()}}}},{key:"readFilterInput",value:function(){var t=[];document.querySelectorAll("#dvModalFilter .filter-fld").forEach(function(e){var a,i=e.id.replace("filter_",""),l=e.value,r=e.dataset.type,n=e.dataset.transid,o={};switch(r=(null===(a=r)||void 0===a?void 0:a.toUpperCase())||""){case"DROPDOWN":if(EntityFilter.inValid(l)||0==l)return;o={ftransid:n,fldname:i,datatype:r,value:l=$(e).val()},t.push(o);break;case"DATE":var c=e.querySelectorAll("input"),s=c[0],d=c[1];if(""==s.value&&""==d.value)return;o={ftransid:n,fldname:i,datatype:r,from:"",to:""},""!=s.value&&(l=moment(s.value,advFilterDtCulture).format("DD-MMM-YYYY"),o.from=l),""!=d.value&&(l=moment(d.value,advFilterDtCulture).format("DD-MMM-YYYY"),o.to=l),o.condition=$("#".concat(e.id,"_dateoption option:selected")).val(),t.push(o);break;case"NUMERIC":var u=e.querySelectorAll("input"),p=u[0],f=u[1];if(""==p.value&&""==f.value)return;o={ftransid:n,fldname:i,datatype:r,from:"",to:""},""!=p.value&&(l=p.value,o.from=l),""!=f.value&&(l=f.value,o.to=l),t.push(o);break;case"TEXT":var v=$(e).val();if(_entityCommon.inValid(v))return;(o={ftransid:n,fldname:i,datatype:r}).value=l,o.condition=document.querySelector("#".concat(e.id,"_searchoption")).value||"CONTAINS",t.push(o)}}),this.activeFilterArray=t}},{key:"handleApply",value:function(){this.activeFilterArray=[],this.readFilterInput();var t=this.constructFilterCaption(this.activeFilterArray);this.activeFilterId=this.activeFilterId||this.getCurrentTimestamp(),this.activeFilterName=t;var e=!1;if(0!=this.activeFilterArray.length){if($("#filterGroupCheckbox").is(":checked")){$("#filterGroupModalWrapper").modal("show");var a=$("#filterGroupName").val();_entityCommon.inValid(a)||(this.activeFilterName=a),e=!0}else $("#filterGroupModalWrapper").modal("hide"),e=!1;this.filterObj[this.activeFilterId]={caption:this.activeFilterName,filter:this.activeFilterArray,save:e},this.createFilterPills(),e&&this.saveFilters(),this.applyFilters()}else showAlertDialog("error","Please select atleast one filter.")}},{key:"saveFilters",value:function(){var t={};for(var e in this.filterObj){var a;1==(null===(a=this.filterObj[e])||void 0===a?void 0:a.save)&&(t[e]=this.filterObj[e])}var i={page:this.pageName,transId:this.entityTransId,properties:{FILTERS:JSON.stringify(t)},allUsers:!1};_entityCommon.setAnalyticsDataWS(i,function(){},function(t){showAlertDialog("error",t.status+" "+t.statusText)})}},{key:"removeFilter",value:function(t){$("div.".concat(t)).remove();var e={};for(var a in delete this.filterObj[t],this.filterObj){var i;!0===(null===(i=this.filterObj[a])||void 0===i?void 0:i.save)&&(e[a]=this.filterObj[a])}0===Object.keys(e).length&&($(".filterPills").html(""),$(".filterPills").addClass("d-none"),handlePillClick("All"));var l={page:this.pageName,transId:this.entityTransId,properties:{FILTERS:JSON.stringify(e)},allUsers:!1};_entityCommon.setAnalyticsDataWS(l,function(){},function(t){showAlertDialog("error",t.status+" "+t.statusText)}),$(".filterPills .".concat(t)).remove()}},{key:"constructFilterCaption",value:function(t){return t.map(function(t){switch(t.datatype){case"TEXT":return t.value;case"DATE":var e="";if("customOption"==t.condition)t.from&&(e+="from ".concat(t.from," ")),t.to&&(e+="till ".concat(t.to));else{var a=dateOptionsId.indexOf(t.condition);e+=dateOptions[a]}return e;case"NUMERIC":return"".concat(t.from||"-"," to ").concat(t.to||"-");case"DROPDOWN":return t.value.join(", ");default:return""}}).join(", ")}},{key:"applyFilters",value:function(){}},{key:"generateFilterString",value:function(t,e,a){return a?"".concat(t,":").concat(a,":").concat(e):"".concat(t,":").concat(e)}},{key:"getCurrentTimestamp",value:function(){return"Filter-"+(new Date).toISOString().replace(/[-:TZ.]/g,"")}},{key:"createFilterLayout",value:function(){var t=this,e=arguments.length>0&&arguments[0]!==undefined&&arguments[0];$("#dvModalFilter").html(""),e||$("#filterGroupName").val(""),this.metaData.forEach(function(e){"T"!==e.hide&&t.generateFilterHTML(e)}),this.initializeDropdowns(),this.initializeDatePickers()}},{key:"generateFilterHTML",value:function(t){var e,a,i,l=this.getFieldDataType(t),r=t.fldcap||"",n="filter_".concat(t.fldname),o=t.fldname,c=t.ftransid,s="";if(!("BUTTON"===(null===(e=l)||void 0===e?void 0:e.toUpperCase())||"ATTACHMENTS"===(null===(a=l)||void 0===a?void 0:a.toUpperCase())||"IMAGE"===(null===(i=l)||void 0===i?void 0:i.toUpperCase())||["transid","axpeg_nextlevel"].indexOf(o.toLowerCase())>-1)){switch("n"===t.fdatatype&&(l="Numeric"),l){case"DropDown":s='\n                <div class="row" data-type="'.concat(l,'">\n                    <div class="col-md-3 fldCaption"><p class="form-group">').concat(r,'</p></div>\n                    <div class="col-md-9 fldCaption">\n                        <select class="form-control filter-fld" data-type="').concat(l,'" data-transid="').concat(c,'" id="').concat(n,'" name="').concat(l,'" multiple>\n                        </select>\n                    </div>\n                </div>');break;case"Numeric":s='\n                <div class="row filter-fld" data-type="'.concat(l,'" id="').concat(n,'" data-type="').concat(l,'" data-transid="').concat(c,'">\n                    <div class="col-md-3 fldCaption"><p class="form-group">').concat(r,'</p></div>\n                    <div class="col-md-9">\n                        <div class="form-group form-row fldCaption">\n                            <div class="col-md-6 col"><label>From</label><input type="number" id="').concat(n,'_from" class="form-control" /></div>\n                            <div class="col-md-6 col"><label>To</label><input type="number" id="').concat(n,'_to" class="form-control" /></div>\n                        </div>\n                    </div>\n                </div>');break;case"Date":s+='<div class="row filter-fld" data-type="'.concat(l,'" id="').concat(n,'" data-transid="').concat(c,'"><div class="col-md-3 fldCaption"><p class="form-group ">').concat(r,'</p></div>\n                                    <div class="col-md-4 fldCaption">\n                                    <select class="form-select dateFilter" type="text" id="').concat(n,'_dateoption" name="').concat(n,'" data-field="').concat(o,'" onchange="generateAdvFilterDates(\'').concat(n,"');\">");for(var d=0;d<dateOptions.length;d++)s+="<option value=".concat(dateOptionsId[d],">").concat(dateOptions[d],"</option>");s+='</select> \n                                    </div>\n                                    <div class="col-md-5">\n                                        <div class="form-group form-row fldCaption">\n                                        <div class="col-md-6 col">\n                                        <label>From</label>           \n                                         <input id="'.concat(n,'_from" name="').concat(n,'_from" value="" maxlength="10" type="date" class="form-control flatpickr-input" data-input="" onchange="validateDateRange(\'').concat(n,'\');">\n                                        </div>\n                                        <div class="col-md-6 col">\n                                        <label>To</label>           \n                                        <input id="').concat(n,'_to" name="').concat(n,'_to" value="" maxlength="10" type="date" class="form-control flatpickr-input" data-input="" onchange="validateDateRange(\'').concat(n,"');\">\n                                        </div></div></div>   \n                                    </div>");break;default:s='\n                <div class="row" data-type="'.concat(l,'">\n                    <div class="col-md-3 fldCaption"><p class="form-group">').concat(r,'</p></div>\n                    <div class="col-md-4 fldValue">\n                        <select class="form-select" id="').concat(n,'_searchoption">\n                            <option value="STARTSWITH">Starts with</option>\n                            <option value="EQUALS">Equals</option>\n                            <option value="CONTAINS">Contains</option>\n                            <option value="ENDSWITH">Ends with</option>\n                        </select>\n                    </div>\n                    <div class="col-md-5 fldValue"><input type="text" id="').concat(n,'" data-type="TEXT" class="form-control filter-fld" data-transid="').concat(c,'"/></div>\n                </div>')}$("#dvModalFilter").append(s)}}},{key:"updateFilterLayout",value:function(t){t.filter.forEach(function(t){var e=t.datatype.toUpperCase(),a=t.fldname,i=t.condition,l=t.value;switch(e){case"TEXT":document.getElementById("filter_".concat(a)).value=l,document.getElementById("filter_".concat(a,"_searchoption")).value=i;break;case"DROPDOWN":l.forEach(function(t){var e=new Option(t,t);$("#filter_".concat(a)).append(e)}),$("#filter_".concat(a)).val(l).trigger("change");break;case"DATE":document.getElementById("filter_".concat(a,"_dateoption")).value=i,$("#filter_".concat(a,"_dateoption")).trigger("change");var r=document.getElementById("filter_".concat(a,"_from")),n=document.getElementById("filter_".concat(a,"_to"));"customOption"===i?(r.value=moment(t.from,"DD-MMM-YYYY").format(advFilterDtCulture)||"",n.value=moment(t.to,"DD-MMM-YYYY").format(advFilterDtCulture)||"",$(r).prop("disabled",!1).addClass("disabledDate"),$(n).prop("disabled",!1).addClass("disabledDate")):($(r).prop("disabled",!0).removeClass("disabledDate"),$(n).prop("disabled",!0).removeClass("disabledDate"));break;case"NUMERIC":var o=document.getElementById("filter_".concat(a,"_from")),c=document.getElementById("filter_".concat(a,"_to"));o.value=t.from||"",c.value=t.to||""}})}},{key:"getFieldDataType",value:function(t){if(!EntityFilter.inValid(t.cdatatype))return t.cdatatype;switch(t.fdatatype){case"n":return"Numeric";case"d":return"Date";case"c":return"Text";case"i":return"Image";case"t":default:return"Text"}}},{key:"initializeDropdowns",value:function(){document.querySelectorAll("#dvModalFilter .filter-fld[data-type=DropDown]").forEach(function(t){var e=t.id.replace("filter_",""),a=t.dataset.transid;$(t).select2({multiple:!0,ajax:{url:top.window.location.href.toLowerCase().substring(0,top.window.location.href.toLowerCase().indexOf("/aspx/"))+"/aspx/Analytics.aspx/GetEntityDropDownDataWS",type:"POST",dataType:"json",contentType:"application/json",delay:250,data:function(t){var i={fldId:e,transId:a};return JSON.stringify(i)},processResults:function(t){try{var e,a=JSON.parse(t.d).result;return a&&null!==(e=a.data)&&void 0!==e&&e.data&&Array.isArray(a.data.data)?{results:a.data.data.map(function(t){return{id:t.datavalue,text:t.datavalue}}).filter(function(t){var e;return null!==t.id&&"null"!==(null===(e=t.id)||void 0===e?void 0:e.toLowerCase())})}:(console.warn("data is not in the expected format."),{results:[]})}catch(i){return console.error("Error processing results: ",i),{results:[]}}},cache:!0}})})}},{key:"initializeDatePickers",value:function initializeDatePickers(){var glCulture=eval(callParent("glCulture")),dtFormat="en-us"===glCulture?"m/d/Y":"d/m/Y";$(".flatpickr-input").flatpickr({dateFormat:dtFormat,disableMobile:!0})}},{key:"clearFilters",value:function(){document.querySelectorAll("#dvModalFilter .filter-fld").forEach(function(t){var e=t.dataset.type;if(!_entityCommon.inValid(e))switch(e=e.toUpperCase()){case"DROPDOWN":$(t).val(""),$(t).trigger("change");break;case"NUMERIC":var a=t.querySelectorAll("input"),i=a[0],l=a[1];i.value="",l.value="";break;case"DATE":var r=t.querySelectorAll("input"),n=r[0],o=r[1];n.value="",o.value="";break;default:t.value=""}})}},{key:"filterModelClose",value:function(){$("#filterGroupName").val(""),$("#filterGroupModalWrapper").modal("hide"),document.getElementById("filterGroupCheckbox").checked=!1,document.getElementById("filterGroupName").disabled=!0,$("#dvModalFilter").html(""),$("#filterModal").modal("hide")}},{key:"createFilterPills",value:function(){0===Object.keys(this.filterObj).length?$(".filterPills").css("display","none"):$(".filterPills").css("display","flex"),$(".filterPills").html("");var t="";for(var e in this.filterObj)t+='<div class="'.concat(e,' filterGroupBadge badge rounded-pill bg-primary d-flex align-items-center gap-2 py-2 px-6" role="button" style="max-width: fit-content;" data-toggle="tooltip" data-placement="top" data-html="true" title="').concat(this.filterObj[e].caption,'" onclick="handlePillClick(\'').concat(e,"')\">\n                ").concat(this.filterObj[e].caption,"\n                <span title='edit' class=\"pillEditButton material-icons btn btn-primary px-2 py-1\" onclick=\"editPill('").concat(e,'\'); event.stopPropagation();">edit</span> \n                <span title="remove" class="pillRemoveButton material-icons btn btn-primary px-2 py-1" onclick="removePill(\'').concat(e,"'); event.stopPropagation();\" >close</span> \n                </div>");t&&$(".filterPills").append('<button  class="filterGroupBadge badge rounded-pill bg-primary d-flex align-items-center gap-2 py-2 px-6 border-0" style="max-width: fit-content;" data-toggle="tooltip" data-placement="top" data-html="true" onclick="handlePillClick(\'All\'); return false;">All</button>'+t)}},{key:"editPill",value:function(t){this.activeFilterId=t,this.activeFilterName=this.filterObj[t].caption,document.getElementById("filterGroupName").value=this.activeFilterName,$("#filterModal").modal("show"),this.filterObj[t].save?(document.getElementById("filterGroupCheckbox").checked=!0,document.getElementById("filterGroupName").disabled=!1):(document.getElementById("filterGroupCheckbox").checked=!1,document.getElementById("filterGroupName").disabled=!0),""===$("#dvModalFilter").html()&&this.createFilterLayout(!0),_entityCommon.isValid(this.filterObj[t])&&this.updateFilterLayout(this.filterObj[t])}}],[{key:"inValid",value:function(t){return null===t||t===undefined||""===t}}]),EntityFilter}();function openFilters(){_entityFilter.init()}function resetFilters(){_entityFilter.clearFilters(),_entityFilter.filterModelClose()}function filterModelClose(){_entityFilter.filterModelClose()}function removePill(t){_entityFilter.removeFilter(t),0===Object.keys(_entityFilter.filterObj).length&&handlePillClick("All")}function editPill(t){_entityFilter.editPill(t)}function handleApply(){_entityFilter.handleApply()}function handlePillClick(t){"All"==t?_entityFilter.activeFilterArray=[]:(_entityFilter.activeFilterArray=_entityFilter.filterObj[t].filter,_entityFilter.activeFilterArray.forEach(function(t){if("DATE"===t.datatype.toUpperCase()&&"customOption"!=t.condition){var e=_entityCommon.getDatesBasedonSelectionForBetweenFilter(t.condition);t.from=e.from,t.to=e.to}})),_entityFilter.applyFilters()}function validateDateRange(t){var e=document.getElementById(t+"_from"),a=document.getElementById(t+"_to"),i=e.value,l=a.value;if(i&&l){var r=parseDate(i),n=parseDate(l);if(!r||!n)return void alert("Invalid date format.");n<r&&(alert('The "To" date cannot be earlier than the "From" date.'),a.value="")}}function generateAdvFilterDates(t){var e=document.querySelector("#".concat(t,"_dateoption")).value,a=(new Date,document.querySelector("#".concat(t,"_from"))),i=document.querySelector("#".concat(t,"_to")),l=_entityCommon.getDatesBasedonSelection(e);a.value=l.from,i.value=l.to,"customOption"==e?(a.disabled=!1,i.disabled=!1,a.classList.add("disabledDate"),i.classList.add("disabledDate")):(a.disabled=!0,i.disabled=!0,a.classList.remove("disabledDate"),i.classList.remove("disabledDate"))}