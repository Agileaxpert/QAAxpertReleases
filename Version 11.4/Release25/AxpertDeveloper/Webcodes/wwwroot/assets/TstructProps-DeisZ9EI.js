import{r as a,A as Ce,F as we,u as Se,a as Fe,b as Le,d as Te,c as Ee,j as e,S as Oe,e as Ae,g as Pe,M as P,C as R,D as S,t as Re,f as Me,v as Ue,i as Ie,h,k as qe,l as M,m as Ve,n as ze,o as $e}from"./index-CakuZJaV.js";import{M as oe}from"./multiselect.esm-CZfgxvSW.js";const pt=Be=>{const{metadataMaster:U,setMetadataMaster:ie,expandedKeys:Je,setExpandedKeys:ce,SaveInProgList:ne,setSaveInProgList:I,changedStructList:We,setChangedStructList:Ke,structSaveErrorList:Ge,setStructSaveErrorList:q,proj:F,UserName:b,sessionKey:pe,showLog:me,baseURL:j,activeFormDetails:Qe,setActiveFormDetails:de,toast:d,toggleProgress:He,fetchStructDataFromDB:V,beforeFormSubmit:ue,setShowAppLoader:f,setDndPopupOpen:he,setDndPopupMode:fe,setDndTreeData:ge}=a.useContext(Ce),{formdata:t,setFormData:g,isFormDirty:ke,setIsFormDirty:L,currChangedFields:xe,setCurrChangedFields:Xe,DDLloader:k,setDDLLoader:Ye,activeDDLField:y,setActiveDDLField:Ze,handleFieldChange:o,updateDependentFields:Ne,getParamJSON:et,getDependencyJSON:tt,getDropdownData:st,handleDropdown:v,validateSQL:at,getFldDefVal:lt,validateExprsn:rt,getSQLHintObj:ot}=a.useContext(we),z=Se(),l=Fe().state;Le();const[x,N]=a.useState(!0),[$,B]=a.useState(!1),[D,J]=a.useState(!0),[C,W]=a.useState(!0),[w,K]=a.useState(!0),[T,G]=a.useState([]);a.useState(!1);const[E,Q]=a.useState([]),[O,H]=a.useState([]),[X,Y]=a.useState([]),[Z,ee]=a.useState([]),_e={name:"",caption:"",schema:"",menuaccess:!0,pform:"yes",saveCtrlFld:"",saveCtrlFldCaption:"",saveCtrlFldsDDN:"",dltCtrlFld:"",dltCtrlFldCaption:"",dltCtrlFldsDDN:"",tracking:!1,trackby:"",trackusrs:"",trackUsrsDDN:[],trackfldOption:"",trackFlds:"",trackFldCaps:"",trackFldsDDN:[],allowconfig:!1,enablecache:!1,enablewf:!1,allowattch:!1,enableListVW:!0,purpose:""};let _=a.useRef(),te=a.useRef(),se=a.useRef(),ae=a.useRef(),le=a.useRef(),re=a.useRef(!0);a.useEffect(()=>{B(!1),L(!1),N(!0),J(!0),W(!0),K(!0),de(l),l.mode=="edit"?(async()=>{if(l.structstatus=="ready"){const s=new URL(`${j}/GetData/form`);s.searchParams.append("projname",F),s.searchParams.append("username",b),s.searchParams.append("structType","tstruct"),s.searchParams.append("structName",l.structname),s.searchParams.append("compName","props");try{const i=await fetch(s,{method:"POST"});if(i.ok){const n=await i.json();if(n.status!="failure")n.status=="locked"&&(d.current.show({severity:"warn",summary:"warning",detail:n.message}),B(!0)),g(JSON.parse(n.result)),setTimeout(()=>{var r;N(!1),(r=_.current)==null||r.scrollIntoView({behavior:"smooth"})},200);else{const r=await V(l.structname,"tstruct");r&&(g(r),N(!1))}}else d.current.show({severity:"error",summary:"Error!",detail:i.statusText})}catch(i){d.current.show({severity:"error",summary:"Error!",detail:i})}}else{const s=await V(l.structname,"tstruct");s&&(g(s),N(!1))}})():(g(_e),setTimeout(()=>{var s;N(!1),(s=_.current)==null||s.scrollIntoView({behavior:"smooth"})},200)),Q([]),H([]),Y([]),ee([])},[l]),a.useEffect(()=>{const s=Ne(t,xe,Te);Object.keys(s).length>0&&g(i=>({...i,...s}))},[t]),a.useEffect(()=>{if(!x)if($)Ee("right-panel");else{const s=_.current.querySelector("input:not([readonly]):not([disabled]), textarea:not([readonly]):not([disabled]), select:not([readonly]):not([disabled])");s&&s.focus()}},[x]),a.useLayoutEffect(()=>{if(!x)if(re.current){const s=document.getElementsByClassName("section_label"),i=[];for(let n of s)i.push(n.innerText);G(i),re.current=!1}else{const s=document.getElementsByClassName("section_label"),i=[];for(let n of s)i.push(n.innerText);G(i)}},[t,x]);const be=s=>{if(s==="Main")return te;if(s==="Options")return se;if(s==="Tracking")return ae},je=s=>{s.target.value=Ue(s.target.value),o(s)},ye=async()=>{L(!1);let s="";(async()=>{if(t.name=="")return s="Transid can not be empty",!1;if(Ie(t.name))return s="Name cannot be a reserved keyword",!1;if(t.caption=="")return s="Caption can not be empty",!1;if(l.mode=="new"){if(U.some(r=>r.structtype==="tstruct"&&r.structname.toLowerCase()===t.name.toLowerCase()))return s="Duplicate Transid is not allowed.",!1;{f(!0);const r=new URL(`${j}/General/checkduplicatestructname`);if(r.searchParams.append("ProjName",F),r.searchParams.append("UserName",b),r.searchParams.append("StructName",t.name.toLowerCase()),r.searchParams.append("StructType","tstruct"),!(await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)return f(!1),s="Duplicate Transid is not allowed.",!1}}return!0})().then(async n=>{if(!n)f(!1),L(!0),d.current.show({severity:"error",summary:"Error!",detail:s});else{f(!0);const u=h("tstruct",t.name);var r=`${j}♠${b}♠${u}`;if(ue(u,r,l,t),l.mode==="edit"){let c=[...U],p;c=c.filter(m=>{if(m.key===h("tstruct",t.name,""))p={...m,structcaption:t.caption,title:e.jsx(qe,{node:{...m,structcaption:t.caption}})};else return m}),c.splice(0,0,p),ie(c)}let De={mode:l.mode,projName:F,userName:b,sessionID:pe,trace:me,structName:t.name,structCaption:t.caption,structType:"tstruct",isComp:!1,compJSON:JSON.stringify({}),propvalJSON:JSON.stringify(t)};await fetch(`${j}/SaveFormData`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(De)}).then(c=>c.ok?c.json():c.json().then(p=>{throw new Error(p)})).then(async c=>{if(c.success){f(!1),I(m=>m.filter(A=>A!==u)),localStorage.removeItem(r);var p=`${t.caption} (${t.name}) created successfully.`;if(l.mode=="edit"&&(p=`${t.caption} (${t.name}) saved successfully.`),d.current.show({severity:"success",summary:"success",detail:p}),l.mode=="new"){const m={structtype:"tstruct",structname:t.name,structcaption:t.caption,structstatus:"ready",key:h("tstruct",t.name,""),title:e.jsx(M,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,structstatus:"ready"}}),data:t.name,isLeaf:!1,icon:e.jsx(Ve,{}),childrenfetched:!0,className:"dropAtNode",children:[{key:h("tstruct",t.name,"dc1"),title:e.jsx(M,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"dc",compname:"dc1",compcaption:t.caption,ordno:1}}),isLeaf:!1,ordno:1,structtype:"tstruct",structname:t.name,structcaption:t.caption,childrenfetched:!0,comp:"dc",compname:"dc1",compcaption:t.caption,asgrid:!1,tablename:t.name+"1",icon:e.jsx(ze,{}),className:"dropAtNode",children:[]},{key:h("tstruct",t.name,"defbtns"),title:e.jsx(M,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"defbtns",compname:"defbtns",compcaption:"Default Buttons",ordno:1}}),isLeaf:!0,ordno:1,structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"defbtns",compname:"defbtns",compcaption:"Default Buttons",icon:e.jsx($e,{})}]};ce(A=>[...A,h("tstruct",t.name,"")]),z("/"),ge([m]),fe("new"),he(!0)}}else throw new Error(c.message)}).catch(c=>{f(!1),I(p=>p.filter(m=>m!==u)),q[u]==null&&q(p=>[...p,u]),c.message=="Session authentication failed."?(d.current.show({severity:"error",summary:"Error!",detail:"Session expired!"}),z("/logout")):d.current.show({severity:"error",summary:"Error!",detail:"Error while saving data!"})})}})},ve=()=>{const s=h("tstruct",l.structname);return!$&&ke?!(l.mode=="edit"&&ne.includes(s)):!1};return x?e.jsx(Oe,{}):e.jsx(e.Fragment,{children:Object.keys(t).length===0?e.jsx("div",{}):e.jsxs("div",{className:"proplist_wrapper",ref:_,children:[e.jsx(Ae,{title:Pe(t.name,t.caption),path:"Tstructs",type:"tstprops"}),e.jsxs("div",{id:"quickLinks",className:"",children:[e.jsx("button",{onClick:()=>{_.current.scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".quicklinks_button").forEach(s=>s.classList.remove("quicklinks_active_button"))},className:"p-2",children:"Top"}),T==null?void 0:T.map(s=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"separator",children:"."}),e.jsx("button",{onClick:i=>{document.querySelectorAll(".quicklinks_button").forEach(r=>r.classList.remove("quicklinks_active_button")),i.currentTarget.classList.add("quicklinks_active_button"),be(s).current.scrollIntoView({behavior:"smooth"})},className:"quicklinks_button p-2",children:s})]})),e.jsx("span",{className:"separator",children:"."}),e.jsx("button",{onClick:()=>{le.current.scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".quicklinks_button").forEach(s=>s.classList.remove("quicklinks_active_button"))},className:"p-2",children:"Bottom"})]}),e.jsx("div",{className:"proplist_body",children:e.jsxs("form",{children:[e.jsx("div",{className:"proplist_label",id:"proplist_label_main",ref:te,children:e.jsxs("a",{role:"button",onClick:()=>J(!D),"aria-expanded":D,"aria-controls":"proplist_collapse_main",className:"d-flex align-items-center",children:[e.jsx(P,{className:"me-2 collapse_icon",style:{transform:D?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Main"})]})}),e.jsx("div",{id:"proplist_main",className:"proplist_division",children:e.jsx(R,{in:D,children:e.jsxs("div",{id:"proplist_collapse_main",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsxs("li",{className:"list-group-item  proplist_item  proplist_key",children:["Transid & Caption ",e.jsx("span",{className:"allowempty",children:"*"})]}),e.jsxs("li",{className:"list-group-item  proplist_item proplist_value flex-nowrap",children:[e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpName",name:"name",value:t.name=="_ _"?"":t.name,onChange:je,maxLength:"5",type:"text","aria-label":"transid",placeholder:"Enter Transid",readOnly:l.mode!="new",disabled:l.mode=="edit"}),e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpCaption",name:"caption",value:t.caption=="_ _"?"":t.caption,onChange:o,maxLength:"50",type:"text","aria-label":"caption",placeholder:"Enter Caption"})]})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key",children:"Form Accessible From Menu?"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("div",{className:"form-check form-switch ",children:e.jsx("input",{className:"form-check-input  proplist_formcontrol",type:"checkbox",id:"chkMenuAccess",name:"menuaccess",onChange:o,checked:t.menuaccess})})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key",children:"Schema"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpSchema",name:"schema",onChange:o,value:t.schema,type:"text","aria-label":"schema"})})]})]})})}),e.jsx("div",{className:"proplist_label",id:"proplist_label_options",ref:se,children:e.jsxs("a",{role:"button",onClick:()=>W(!C),"aria-expanded":C,"aria-controls":"proplist_collapse_options",className:"d-flex align-items-center",children:[e.jsx(P,{className:"me-2 collapse_icon",style:{transform:C?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Options"})]})}),e.jsx("div",{className:"proplist_division ",id:"proplist_options",children:e.jsx(R,{in:C,children:e.jsxs("div",{id:"proplist_collapse_options",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key "}),e.jsxs("li",{className:"list-group-item  proplist_item proplist_value",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"allowconfig",onChange:o,id:"chkAllowConfig",checked:t.allowconfig===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkAllowConfig",children:"Allow configuration"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",value:"",name:"enablecache",onChange:o,id:"chkEnblCache",checked:t.enablecache===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnblCache",children:"Enable cached saving"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"allowattch",onChange:o,value:"",id:"chkAlwAtt",checked:t.allowattch===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkAlwAtt",children:"Allow Attachment"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"enableListVW",onChange:o,value:"",id:"chkEnaList",checked:t.enableListVW===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnbllst",children:"Enable List View"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"enablewf",onChange:o,value:"",id:"chkEnaWf",checked:t.enablewf===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnblWf",children:"Enable Workflow"})]})]})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Save control field"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(S,{name:"saveCtrlFldsDDN",value:t.saveCtrlFldsDDN,onChange:o,onShow:()=>v("saveCtrlFldsDDN","FLDLIST",E,Q,l),options:E.length?E:t.saveCtrlFldsDDN?[t.saveCtrlFldsDDN]:[],...y==="saveCtrlFldsDDN"&&k?{loading:!0}:{},optionLabel:"caption",placeholder:"-- select --",showClear:!0,filter:!0,display:"chip",id:"selSaveCtrl",className:"proplist_formcontrol"})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Delete control field"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(S,{name:"dltCtrlFldsDDN",value:t.dltCtrlFldsDDN,onChange:o,onShow:()=>v("dltCtrlFldsDDN","FLDLIST",O,H,l),options:O.length?O:t.dltCtrlFldsDDN?[t.dltCtrlFldsDDN]:[],...y==="dltCtrlFldsDDN"&&k?{loading:!0}:{},optionLabel:"caption",placeholder:"-- select --",showClear:!0,filter:!0,display:"chip",id:"selDltCtrl",className:"proplist_formcontrol"})})]})]})})}),e.jsx("div",{className:"proplist_label",id:"proplist_label_Tracking",ref:ae,children:e.jsxs("a",{role:"button",onClick:()=>K(!w),"aria-expanded":w,"aria-controls":"proplist_collapse_tracking",className:"d-flex align-items-center",children:[e.jsx(P,{className:"me-2 collapse_icon",style:{transform:w?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Tracking"})]})}),e.jsx("div",{className:"proplist_division ",id:"proplist_Tracking",children:e.jsx(R,{in:w,children:e.jsxs("div",{id:"proplist_collapse_tracking",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("div",{className:"form-check form-switch ",children:e.jsx("input",{className:"form-check-input  proplist_formcontrol",type:"checkbox",id:"chkTrack",name:"tracking",onChange:o,checked:t.tracking})})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track changes made by"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(S,{name:"trackby",value:t.trackby,onChange:o,options:Re,optionLabel:"caption",optionValue:"name",placeholder:"-- select --",showClear:!0,id:"selTrckChngUsr",className:"proplist_formcontrol",ariaLabel:"Track changes made by",...t.tracking?{}:{disabled:!0}})})]}),t.tracking&&t.trackby==="Selected Users"&&e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track change users"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(oe,{name:"trackUsrsDDN",value:t.trackUsrsDDN,onChange:o,onShow:()=>v("trackUsrsDDN","USERLIST",X,Y,l),...y==="trackUsrsDDN"&&k?{loading:!0}:{},emptyMessage:k?"Loading...":"No options found",options:X,optionLabel:"caption",placeholder:"--- Select Users ---",filter:!0,display:"chip",id:"selTrkUsrs",className:"proplist_formcontrol"})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track changes to fields"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(S,{name:"trackfldOption",value:t.trackfldOption,onChange:o,options:Me,optionLabel:"caption",optionValue:"name",placeholder:"-- select --",showClear:!0,id:"selTrkChngFld",className:"proplist_formcontrol",ariaLabel:"Track changes to fields",...t.tracking?{}:{disabled:!0}})})]}),t.tracking&&t.trackfldOption==="Selected fields"&&e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track change fields"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(oe,{name:"trackFldsDDN",value:t.trackFldsDDN,onChange:o,onShow:()=>v("trackFldsDDN","FLDLIST",Z,ee,l),...y==="trackFldsDDN"&&k?{loading:!0}:{},options:Z,optionLabel:"caption",placeholder:"--- Select Fields ---",filter:!0,display:"chip",id:"selTrkFlds",className:"proplist_formcontrol"})})]})]})})}),e.jsx("div",{className:"proplist_division mt-4",ref:le,children:e.jsx("div",{id:"proplist_collapse_purpose",className:"proplist_collapse",children:e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item proplist_key",children:"Purpose"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value ",children:e.jsx("div",{className:" w-100",children:e.jsx("textarea",{className:"form-control proplist_formcontrol w-100",id:"txtPurpose",name:"purpose",onChange:o,rows:"3"})})})]})})}),e.jsx("button",{type:"button",onClick:ye,className:"btn btn-primary btnSubmit",...ve()?{}:{disabled:!0},children:"Submit"})]})})]})})};export{pt as default};
