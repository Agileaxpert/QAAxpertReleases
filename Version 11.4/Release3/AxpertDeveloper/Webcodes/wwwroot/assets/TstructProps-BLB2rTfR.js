import{r as a,A as ye,u as ve,a as Ce,b as De,d as we,c as Se,j as e,S as Fe,e as Le,g as Te,M as R,C as P,D as w,t as Ee,f as Oe,v as Ae,i as Re,h as u,k as S,l as Pe,m as Ue,n as Me}from"./index-DSijVzXk.js";import{M as re}from"./multiselect.esm-BvRwmQyz.js";const He=Ie=>{let{metadataMaster:U,setMetadataMaster:oe,expandedKeys:qe,setExpandedKeys:ie,SaveInProgList:ce,setSaveInProgList:M,changedStructList:ze,setChangedStructList:Ve,structSaveErrorList:$e,setStructSaveErrorList:I,proj:F,UserName:_,sessionKey:ne,showLog:pe,baseURL:b,activeFormDetails:Be,setActiveFormDetails:me,toast:d,formdata:t,setFormData:h,handleFieldChange:r,currChangedFields:de,updateDependentFields:ue,isFormDirty:he,setIsFormDirty:L,DDLloader:f,activeDDLField:j,handleDropdown:y,toggleProgress:We,fetchStructDataFromDB:q,beforeFormSubmit:fe}=a.useContext(ye);const z=ve(),l=Ce().state;De();const[g,k]=a.useState(!0),[V,$]=a.useState(!1),[v,B]=a.useState(!0),[C,W]=a.useState(!0),[D,J]=a.useState(!0),[T,K]=a.useState([]);a.useState(!1);const[E,G]=a.useState([]),[O,H]=a.useState([]),[Q,X]=a.useState([]),[Y,Z]=a.useState([]),ge={name:"",caption:"",schema:"",menuaccess:!0,pform:"yes",saveCtrlFld:"",saveCtrlFldCaption:"",saveCtrlFldsDDN:"",dltCtrlFld:"",dltCtrlFldCaption:"",dltCtrlFldsDDN:"",tracking:!1,trackby:"",trackusrs:"",trackUsrsDDN:[],trackfldOption:"",trackFlds:"",trackFldCaps:"",trackFldsDDN:[],allowconfig:!1,enablecache:!1,enablewf:!1,allowattch:!1,enableListVW:!0,purpose:""};let x=a.useRef(),ee=a.useRef(),te=a.useRef(),se=a.useRef(),ae=a.useRef(),le=a.useRef(!0);a.useEffect(()=>{$(!1),L(!1),k(!0),B(!0),W(!0),J(!0),me(l),l.mode=="edit"?(async()=>{if(l.structstatus=="ready"){const s=new URL(`${b}/GetData/form`);s.searchParams.append("projname",F),s.searchParams.append("username",_),s.searchParams.append("structType","tstruct"),s.searchParams.append("structName",l.structname),s.searchParams.append("compName","props");try{const o=await fetch(s,{method:"POST"});if(o.ok){const p=await o.json();if(p.status!="failure")p.status=="locked"&&(d.current.show({severity:"warn",summary:"warning",detail:p.message}),$(!0)),h(JSON.parse(p.result)),setTimeout(()=>{k(!1),x.current.scrollIntoView({behavior:"smooth"})},200);else{const i=await q(l.structname,"tstruct");i&&(h(i),k(!1))}}else d.current.show({severity:"error",summary:"Error!",detail:o.statusText})}catch(o){d.current.show({severity:"error",summary:"Error!",detail:o})}}else{const s=await q(l.structname,"tstruct");s&&(h(s),k(!1))}})():(h(ge),setTimeout(()=>{k(!1),x.current.scrollIntoView({behavior:"smooth"})},200)),G([]),H([]),X([]),Z([])},[l]),a.useEffect(()=>{const s=ue(t,de,we);Object.keys(s).length>0&&h(o=>({...o,...s}))},[t]),a.useEffect(()=>{if(!g)if(V)Se("right-panel");else{const s=x.current.querySelector("input:not([readonly]):not([disabled]), textarea:not([readonly]):not([disabled]), select:not([readonly]):not([disabled])");s&&s.focus()}},[g]),a.useLayoutEffect(()=>{if(!g)if(le.current){const s=document.getElementsByClassName("section_label"),o=[];for(let p of s)o.push(p.innerText);K(o),le.current=!1}else{const s=document.getElementsByClassName("section_label"),o=[];for(let p of s)o.push(p.innerText);K(o)}},[t,g]);const ke=s=>{if(s==="Main")return ee;if(s==="Options")return te;if(s==="Tracking")return se},xe=s=>{s.target.value=Ae(s.target.value),r(s)},Ne=async()=>{L(!1);let s="";(async()=>{if(t.name=="")return s="Transid can not be empty",!1;if(Re(t.name))return s="Name cannot be a reserved keyword",!1;if(t.caption=="")return s="Caption can not be empty",!1;if(l.mode=="new"){if(U.some(i=>i.structtype==="tstruct"&&i.structname===t.name))return s="Duplicate Transid is not allowed.",!1;{const i=new URL(`${b}/General/checkduplicatestructname`);if(i.searchParams.append("ProjName",F),i.searchParams.append("UserName",_),i.searchParams.append("StructName",t.name),i.searchParams.append("StructType","tstruct"),!(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)return s="Duplicate Transid is not allowed.",!1}}return!0})().then(async p=>{if(!p)L(!0),d.current.show({severity:"error",summary:"Error!",detail:s});else{const m=u("tstruct",t.name);var i=`${b}♠${_}♠${m}`;fe(m,i,l);let N=[...U];if(l.mode==="new"){const n={structtype:"tstruct",structname:t.name,structcaption:t.caption,structstatus:"ready",key:u("tstruct",t.name,""),title:e.jsx(S,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,structstatus:"ready"}}),data:t.name,isLeaf:!1,icon:e.jsx(Pe,{}),childernfetched:!0,className:"dropAtNode",children:[{key:u("tstruct",t.name,"dc1"),title:e.jsx(S,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"dc",compname:"dc1",compcaption:t.caption,ordno:1}}),isLeaf:!1,ordno:1,structtype:"tstruct",structname:t.name,structcaption:t.caption,childernfetched:!0,comp:"dc",compname:"dc1",compcaption:t.caption,asgrid:!1,tablename:t.name+"1",icon:e.jsx(Ue,{}),className:"dropAtNode",children:[]},{key:u("tstruct",t.name,"defbtns"),title:e.jsx(S,{node:{structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"defbtns",compname:"defbtns",compcaption:"Default Buttons",ordno:1}}),isLeaf:!0,ordno:1,structtype:"tstruct",structname:t.name,structcaption:t.caption,comp:"defbtns",compname:"defbtns",compcaption:"Default Buttons",icon:e.jsx(Me,{})}]};N.splice(0,0,n),ie(c=>[...c,u("tstruct",t.name,"")])}else{let n;N=N.filter(c=>{if(c.key===u("tstruct",t.name,""))n={...c,structcaption:t.caption,title:e.jsx(S,{node:{...c,structcaption:t.caption}})};else return c}),N.splice(0,0,n)}oe(N);let be={mode:l.mode,projName:F,userName:_,sessionID:ne,trace:pe,structName:t.name,structCaption:t.caption,structType:"tstruct",isComp:!1,compJSON:JSON.stringify({}),propvalJSON:JSON.stringify(t)};await fetch(`${b}/SaveFormData`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(be)}).then(n=>n.ok?n.json():n.json().then(c=>{throw new Error(c)})).then(async n=>{if(n.success){M(A=>A.filter(je=>je!==m)),localStorage.removeItem(i);var c=`${t.caption} (${t.name}) created successfully.`;l.mode=="edit"&&(c=`${t.caption} (${t.name}) saved successfully.`),d.current.show({severity:"success",summary:"success",detail:c}),l.mode=="new"&&z("/adddc",{state:{structname:t.name,structcaption:t.caption,structkey:m,structtype:"tstruct",mode:"edit",compname:"dc1",isdirty:!1,isfirstTimeLoad:!0}})}else throw new Error(n.message)}).catch(n=>{M(c=>c.filter(A=>A!==m)),I[m]==null&&I(c=>[...c,m]),n.message=="Session authentication failed."?(d.current.show({severity:"error",summary:"Error!",detail:"Session expired!"}),z("/logout")):d.current.show({severity:"error",summary:"Error!",detail:"Error while saving data!"})})}})},_e=()=>{const s=u("tstruct",l.structname);return!V&&he?!(l.mode=="edit"&&ce.includes(s)):!1};return g?e.jsx(Fe,{}):e.jsx(e.Fragment,{children:Object.keys(t).length===0?e.jsx("div",{}):e.jsxs("div",{className:"proplist_wrapper",ref:x,children:[e.jsx(Le,{title:Te(t.name,t.caption),path:"Tstructs",type:"tstprops"}),e.jsxs("div",{id:"quickLinks",className:"",children:[e.jsx("button",{onClick:()=>{x.current.scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".quicklinks_button").forEach(s=>s.classList.remove("quicklinks_active_button"))},className:"p-2",children:"Top"}),T==null?void 0:T.map(s=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"separator",children:"."}),e.jsx("button",{onClick:o=>{document.querySelectorAll(".quicklinks_button").forEach(i=>i.classList.remove("quicklinks_active_button")),o.currentTarget.classList.add("quicklinks_active_button"),ke(s).current.scrollIntoView({behavior:"smooth"})},className:"quicklinks_button p-2",children:s})]})),e.jsx("span",{className:"separator",children:"."}),e.jsx("button",{onClick:()=>{ae.current.scrollIntoView({behavior:"smooth"}),document.querySelectorAll(".quicklinks_button").forEach(s=>s.classList.remove("quicklinks_active_button"))},className:"p-2",children:"Bottom"})]}),e.jsx("div",{className:"proplist_body",children:e.jsxs("form",{children:[e.jsx("div",{className:"proplist_label",id:"proplist_label_main",ref:ee,children:e.jsxs("a",{role:"button",onClick:()=>B(!v),"aria-expanded":v,"aria-controls":"proplist_collapse_main",className:"d-flex align-items-center",children:[e.jsx(R,{className:"me-2 collapse_icon",style:{transform:v?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Main"})]})}),e.jsx("div",{id:"proplist_main",className:"proplist_division",children:e.jsx(P,{in:v,children:e.jsxs("div",{id:"proplist_collapse_main",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsxs("li",{className:"list-group-item  proplist_item  proplist_key",children:["Transid & Caption ",e.jsx("span",{className:"allowempty",children:"*"})]}),e.jsxs("li",{className:"list-group-item  proplist_item proplist_value flex-nowrap",children:[e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpName",name:"name",value:t.name=="_ _"?"":t.name,onChange:xe,maxLength:"5",type:"text","aria-label":"transid",placeholder:"Enter Transid",readOnly:l.mode!="new",disabled:l.mode=="edit"}),e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpCaption",name:"caption",value:t.caption=="_ _"?"":t.caption,onChange:r,maxLength:"50",type:"text","aria-label":"caption",placeholder:"Enter Caption"})]})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key",children:"Form Accessible From Menu?"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("div",{className:"form-check form-switch ",children:e.jsx("input",{className:"form-check-input  proplist_formcontrol",type:"checkbox",id:"chkMenuAccess",name:"menuaccess",onChange:r,checked:t.menuaccess})})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key",children:"Schema"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("input",{className:"form-control form-control-sm proplist_formcontrol",id:"inpSchema",name:"schema",onChange:r,value:t.schema,type:"text","aria-label":"schema"})})]})]})})}),e.jsx("div",{className:"proplist_label",id:"proplist_label_options",ref:te,children:e.jsxs("a",{role:"button",onClick:()=>W(!C),"aria-expanded":C,"aria-controls":"proplist_collapse_options",className:"d-flex align-items-center",children:[e.jsx(R,{className:"me-2 collapse_icon",style:{transform:C?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Options"})]})}),e.jsx("div",{className:"proplist_division ",id:"proplist_options",children:e.jsx(P,{in:C,children:e.jsxs("div",{id:"proplist_collapse_options",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key "}),e.jsxs("li",{className:"list-group-item  proplist_item proplist_value",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"allowconfig",onChange:r,id:"chkAllowConfig",checked:t.allowconfig===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkAllowConfig",children:"Allow configuration"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",value:"",name:"enablecache",onChange:r,id:"chkEnblCache",checked:t.enablecache===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnblCache",children:"Enable cached saving"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"allowattch",onChange:r,value:"",id:"chkAlwAtt",checked:t.allowattch===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkAlwAtt",children:"Allow Attachment"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"enableListVW",onChange:r,value:"",id:"chkEnaList",checked:t.enableListVW===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnbllst",children:"Enable List View"})]}),e.jsxs("div",{className:"form-check ",children:[e.jsx("input",{className:"form-check-input proplist_formcontrol",type:"checkbox",name:"enablewf",onChange:r,value:"",id:"chkEnaWf",checked:t.enablewf===!0}),e.jsx("label",{className:"form-check-label",htmlFor:"chkEnblWf",children:"Enable Workflow"})]})]})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Save control field"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"saveCtrlFldsDDN",value:t.saveCtrlFldsDDN,onChange:r,onShow:()=>y("saveCtrlFldsDDN","FLDLIST",E,G,l),options:E.length?E:t.saveCtrlFldsDDN?[t.saveCtrlFldsDDN]:[],...j==="saveCtrlFldsDDN"&&f?{loading:!0}:{},optionLabel:"caption",placeholder:"-- select --",showClear:!0,filter:!0,display:"chip",id:"selSaveCtrl",className:"proplist_formcontrol"})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Delete control field"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"dltCtrlFldsDDN",value:t.dltCtrlFldsDDN,onChange:r,onShow:()=>y("dltCtrlFldsDDN","FLDLIST",O,H,l),options:O.length?O:t.dltCtrlFldsDDN?[t.dltCtrlFldsDDN]:[],...j==="dltCtrlFldsDDN"&&f?{loading:!0}:{},optionLabel:"caption",placeholder:"-- select --",showClear:!0,filter:!0,display:"chip",id:"selDltCtrl",className:"proplist_formcontrol"})})]})]})})}),e.jsx("div",{className:"proplist_label",id:"proplist_label_Tracking",ref:se,children:e.jsxs("a",{role:"button",onClick:()=>J(!D),"aria-expanded":D,"aria-controls":"proplist_collapse_tracking",className:"d-flex align-items-center",children:[e.jsx(R,{className:"me-2 collapse_icon",style:{transform:D?"":"rotate(180deg)"}}),e.jsx("label",{className:"section_label",children:"Tracking"})]})}),e.jsx("div",{className:"proplist_division ",id:"proplist_Tracking",children:e.jsx(P,{in:D,children:e.jsxs("div",{id:"proplist_collapse_tracking",className:"proplist_collapse",children:[e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx("div",{className:"form-check form-switch ",children:e.jsx("input",{className:"form-check-input  proplist_formcontrol",type:"checkbox",id:"chkTrack",name:"tracking",onChange:r,checked:t.tracking})})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track changes made by"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"trackby",value:t.trackby,onChange:r,options:Ee,optionLabel:"caption",optionValue:"name",placeholder:"-- select --",showClear:!0,id:"selTrckChngUsr",className:"proplist_formcontrol",ariaLabel:"Track changes made by",...t.tracking?{}:{disabled:!0}})})]}),t.tracking&&t.trackby==="Selected Users"&&e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track change users"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(re,{name:"trackUsrsDDN",value:t.trackUsrsDDN,onChange:r,onShow:()=>y("trackUsrsDDN","USERLIST",Q,X,l),...j==="trackUsrsDDN"&&f?{loading:!0}:{},emptyMessage:f?"Loading...":"No options found",options:Q,optionLabel:"caption",placeholder:"--- Select Users ---",filter:!0,display:"chip",id:"selTrkUsrs",className:"proplist_formcontrol"})})]}),e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track changes to fields"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(w,{name:"trackfldOption",value:t.trackfldOption,onChange:r,options:Oe,optionLabel:"caption",optionValue:"name",placeholder:"-- select --",showClear:!0,id:"selTrkChngFld",className:"proplist_formcontrol",ariaLabel:"Track changes to fields",...t.tracking?{}:{disabled:!0}})})]}),t.tracking&&t.trackfldOption==="Selected fields"&&e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item  proplist_key ",children:"Track change fields"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value",children:e.jsx(re,{name:"trackFldsDDN",value:t.trackFldsDDN,onChange:r,onShow:()=>y("trackFldsDDN","FLDLIST",Y,Z,l),...j==="trackFldsDDN"&&f?{loading:!0}:{},options:Y,optionLabel:"caption",placeholder:"--- Select Fields ---",filter:!0,display:"chip",id:"selTrkFlds",className:"proplist_formcontrol"})})]})]})})}),e.jsx("div",{className:"proplist_division mt-4",ref:ae,children:e.jsx("div",{id:"proplist_collapse_purpose",className:"proplist_collapse",children:e.jsxs("ul",{className:"list-group list-group-horizontal proplist_group",children:[e.jsx("li",{className:"list-group-item  proplist_item proplist_key",children:"Purpose"}),e.jsx("li",{className:"list-group-item  proplist_item proplist_value ",children:e.jsx("div",{className:" w-100",children:e.jsx("textarea",{className:"form-control proplist_formcontrol w-100",id:"txtPurpose",name:"purpose",onChange:r,rows:"3"})})})]})})}),e.jsx("button",{type:"button",onClick:Ne,className:"btn btn-primary btnSubmit",..._e()?{}:{disabled:!0},children:"Submit"})]})})]})})};export{He as default};
